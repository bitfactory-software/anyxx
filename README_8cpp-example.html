<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Any++: README.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Any++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('README_8cpp-example.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">README.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>README showcases</p>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="comment">// The MIT License (MIT)</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (c) 2026 Bit Factory Software GmbH</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Permission is hereby granted, free of charge, to any person obtaining a copy</span></div>
<div class="line"><span class="comment">// of this software and associated documentation files (the &quot;Software&quot;), to deal</span></div>
<div class="line"><span class="comment">// in the Software without restriction, including without limitation the rights</span></div>
<div class="line"><span class="comment">// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></div>
<div class="line"><span class="comment">// copies of the Software, and to permit persons to whom the Software is</span></div>
<div class="line"><span class="comment">// furnished to do so, subject to the following conditions:</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// The above copyright notice and this permission notice shall be included in</span></div>
<div class="line"><span class="comment">// all copies or substantial portions of the Software.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></div>
<div class="line"><span class="comment">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></div>
<div class="line"><span class="comment">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></div>
<div class="line"><span class="comment">// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></div>
<div class="line"><span class="comment">// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></div>
<div class="line"><span class="comment">// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></div>
<div class="line"><span class="comment">// SOFTWARE.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// MAGIC for this README.cpp</span></div>
<div class="line"><span class="comment">// https://stackoverflow.com/questions/49980639/specify-alternate-project-level-readme-md-on-github</span></div>
<div class="line"><span class="comment">// mklink in PowerShell</span></div>
<div class="line"><span class="comment">// cmd /c mklink README.md ..\examples\inline_mode\README.cpp</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line">[Hello World!](#showcase1) / [Model Map](#showcase2) / [Type Erased Spaceship](#showcase3) / [Open Dispatch As Visitor](#showcase4) </div>
<div class="line">/ [Crosscast + Factory = Serialization](#showcase5) / [Basic *Any++* std::variant usage](#showcase6) </div>
<div class="line">/ [Basic *Any++* open std::variant usage: <span class="stringliteral">&#39;vany&#39;</span>](#showcase7)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">[![MIT Licence](http:<span class="comment">//img.shields.io/badge/license-MIT-blue.svg)](https://opensource.org/license/mit)</span></div>
<div class="line">[![CI](https:<span class="comment">//github.com/bitfactory-software/anyxx/actions/workflows/ci.yml/badge.svg)](https://github.com/bitfactory-software/anyxx/actions/workflows/ci.yml)</span></div>
<div class="line">[![Static Badge](https:<span class="comment">//img.shields.io/badge/dos-Any%2B%2B-blue)](https://www.alexweb.io/anyxx/)</span></div>
<div class="line"> </div>
<div class="line"># Any++ : How to ``trait`` ``any`` ``<span class="keyword">virtual</span>``, ``<span class="keyword">static</span>`` or ``variant``?</div>
<div class="line"> </div>
<div class="line">&lt;img width=<span class="stringliteral">&quot;908&quot;</span> height=<span class="stringliteral">&quot;760&quot;</span> alt=<span class="stringliteral">&quot;Any++logo-small&quot;</span> src=<span class="stringliteral">&quot;https://github.com/user-attachments/assets/e4766dd4-7a21-486d-9dd0-8725149e0754&quot;</span> /&gt;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">**Any++** enhances the well-known *boost::any* and *std::any* with:</div>
<div class="line"> </div>
<div class="line">- **Flexible choice of underlying storage mechanisms**</div>
<div class="line">  - Type-erased</div>
<div class="line">  - Concrete</div>
<div class="line">  - Variant</div>
<div class="line">- **Extensibility**</div>
<div class="line">  - Ability to add functions and operators <span class="keyword">using</span> Rust-like **traits** (including templates)</div>
<div class="line">  - Support <span class="keywordflow">for</span> **open (multi-)dispatch**</div>
<div class="line">  - Runtime support <span class="keywordflow">for</span> **downcasts and cross-casts**</div>
<div class="line"> </div>
<div class="line">To allow easy **separation of concerns**, the library adds utilities <span class="keywordflow">for</span>:</div>
<div class="line">- Factories</div>
<div class="line">- Hooks</div>
<div class="line">- Load-time extendable members</div>
<div class="line"> </div>
<div class="line">The performance of **dynamic dispatch is on par with <span class="keyword">virtual</span> functions**. </div>
<div class="line"> </div>
<div class="line">The combination of <span class="keyword">static</span> and dynamic dispatch enables </div>
<div class="line">- a hybrid usage of `std::variant` and **type erasure** to balance performance and coupling.</div>
<div class="line">- C++0x-like <span class="keyword">concept</span> maps <span class="keywordflow">for</span> <span class="keyword">static</span> and dynamic customization points and <span class="keywordflow">default</span> behavior.</div>
<div class="line"> </div>
<div class="line">&lt;a name=<span class="stringliteral">&quot;showcase1&quot;</span>&gt;&lt;/a&gt; </div>
<div class="line">### Showcase 1: Basic *Any++* usage</div>
<div class="line">```cpp</div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line">#endif</div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line">#include &lt;bit_factory/anyxx.hpp&gt;</div>
<div class="line">#include &lt;catch2/catch_test_macros.hpp&gt;</div>
<div class="line">#include &lt;string&gt;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace</span> showcase1 {</div>
<div class="line">struct circle {</div>
<div class="line">  [[nodiscard]] std::string draw() const { return <span class="stringliteral">&quot;Hello&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct</span> square {</div>
<div class="line">  [[nodiscard]] std::string draw() const { return <span class="stringliteral">&quot;World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a id="a0" name="a0"></a><a class="code hl_define" href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a>(drawable, (<a id="a1" name="a1"></a><a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)))</div>
<div class="line"> </div>
<div class="line">void draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;anyxx::any&lt;anyxx::val, drawable&gt;&gt; const&amp; drawables) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase1&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Hello\nWorld\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">}  <span class="comment">// namespace showcase1</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line">```</div>
<div class="line">Showcase 1 demonstrates the most basic usage of `Any++` <span class="keywordflow">for</span> type-erased </div>
<div class="line">polymorphism in C++. It defines two simple types, `circle` and `square`, each with a `draw()` method </div>
<div class="line">returning a <span class="keywordtype">string</span>. Using the `Any++` macro system, a `drawable` trait is declared, </div>
<div class="line">specifying the required interface (`draw() <span class="keyword">const</span> -&gt; std::string`).</div>
<div class="line"> </div>
<div class="line">The draw function takes a vector of type-erased any objects that conform to the `drawable` trait.</div>
<div class="line">It shows how to create and use a heterogeneous collection of unrelated objects (`circle` and `square`).</div>
<div class="line"> </div>
<div class="line">[Compiler Explorer](https:<span class="comment">//godbolt.org/z/nGjjs9xva)</span></div>
<div class="line"> </div>
<div class="line">[Here to more Showcases ...](#showcase2) </div>
<div class="line"> </div>
<div class="line">[Here to Docs ...](https:<span class="comment">//www.alexweb.io/anyxx/)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">### Available on vcpkg:</span></div>
<div class="line"> </div>
<div class="line">Install in vcpkg root directory:</div>
<div class="line">```</div>
<div class="line">vcpkg install anyxx</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">In your CMakeLists.txt:</div>
<div class="line">```cmake</div>
<div class="line">find_package(anyxx CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(main PRIVATE bit_factory::anyxx)</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">### Useage in CMakeLists.txt:</span></div>
<div class="line">```</div>
<div class="line">FetchContent_Declare(</div>
<div class="line">    bit_factory::anyxx</div>
<div class="line">    GIT_REPOSITORY https:<span class="comment">//github.com/bitfactory-software/anyxx</span></div>
<div class="line">    GIT_TAG 0.5.0</div>
<div class="line">)</div>
<div class="line">FetchContent_MakeAvailable(anyxx)</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">### Clone the repo:</span></div>
<div class="line">```</div>
<div class="line">git clone - c core.symlinks = <span class="keyword">true</span> https:<span class="comment">//github.com/bitfactory-software/anyxx</span></div>
<div class="line">```</div>
<div class="line"><span class="preprocessor">### Runtime Performance compared</span></div>
<div class="line">| Benchmark Invocation **Time** | 12th Gen Intel(R)&lt;br&gt;Core(TM) i12900H (2.50 GHz)&lt;br&gt;MS Visual C++ 18.0.1 /O2 /Ob2 | AMD Ryzen 9&lt;br&gt; 5900X 12-Core Processor (3.70 GHz)&lt;br&gt;MS Visual C++ 18.2.1 /O2 /Ob2 | 12th Gen Intel(R)&lt;br&gt;Core(TM) i12900H (2.50 GHz)&lt;br&gt;clang-cl /O2 /Ob2 | Source | Data from ... |</div>
<div class="line">|:------------------------------|----------------------------------------------------------------------------------:|---------------------------------------------------------------------------:|-------:| ----------------------------------------------------------------------:|-----------------------:|</div>
<div class="line">| **Single dispatch**           | --- | --- | --- | --- | --- |</div>
<div class="line">| <span class="keyword">virtual</span> function (**reference**) |                                                                              1 |                                                                          1 |        1 | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/20_Tree_virtual_function.cpp) | ``BENCHMARK(&quot;20_Tree virtual function value&quot;) { return expr-&gt;value(); };`` |</span></div>
<div class="line">| any++ <span class="keyword">interface </span>|  x **1** | x **1** | x **1** | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/21_Tree_any.cpp) | ``BENCHMARK(&quot;21_Tree any value&quot;) { return expr-&gt;value(); };`` |</span></div>
<div class="line">| any++ open method ``dispatch``| x **1.5** | x **1.5** | x **1.5** | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/21_Tree_any_dispatch.cpp.cpp) | ``BENCHMARK(&quot;21_Tree any dispatch value&quot;) { return expr-&gt;value(); };`` |</span></div>
<div class="line">| **Double dispatch**                          | --- | --- | --- | --- | --- |</div>
<div class="line">| hand rolled w. <span class="keyword">virtual</span> function (**reference**) | 1 | 1 | 1 | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/30b_Animals_virtual_functions.cpp) | ``BENCHMARK(&quot;30b_Animals virtual functions&quot;)`` |</span></div>
<div class="line">| any++ open method ``dispatch`` | x **1** | x **1** | x **1** | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/31_Animals_any_dispatch.cpp) | ``BENCHMARK(&quot;31_Animals any dispatch&quot;)`` |</span></div>
<div class="line">| ``std::variant`` + ``std::visit``| x 0.8 | x 0.65 | x 0.35 | [Source](https:<span class="comment">//github.com/bitfactory-software/anyxx/blob/master/examples/inline_mode/30a_Animals_variant_visit.cpp) | ``BENCHMARK(&quot;30a_Animals variant visit&quot;)`` |</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">### CI Matrix</span></div>
<div class="line">| OS \ Compiler | MSVC | Clang | GCC |</div>
<div class="line">|:-----------------:|:------:|:-------:|:-----:|</div>
<div class="line">| Windows(latest)           | 19   | 21   | - | </div>
<div class="line">| Ubuntu(latest)           | - | 21   | 14 | </div>
<div class="line">| MacOS(latest)           | - | 21   | 14 | </div>
<div class="line"> </div>
<div class="line">&lt;a name=<span class="stringliteral">&quot;showcase2&quot;</span>&gt;&lt;/a&gt; </div>
<div class="line"><span class="preprocessor">### Showcase 2: *Any++* with Model Map</span></div>
<div class="line">```cpp</div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>showcase2 {</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string edgy_salute()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;edgy World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a>(drawable, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)))</div>
<div class="line"> </div>
<div class="line"><a id="a2" name="a2"></a><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((circle), drawable) {</div>
<div class="line">  <span class="keyword">static</span> std::string draw(circle <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;Silent greetings&quot;</span>; };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((square), drawable) {</div>
<div class="line">  <span class="keyword">static</span> std::string draw(square <span class="keyword">const</span>&amp; self) { <span class="keywordflow">return</span> self.edgy_salute(); };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;anyxx::any&lt;anyxx::val, drawable&gt;&gt; <span class="keyword">const</span>&amp; drawables) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase2&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Silent greetings\nedgy World\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">};  <span class="comment">// namespace showcase2</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line">```</div>
<div class="line">Showcase 2 demonstrates, how to use `Any++`<span class="stringliteral">&#39;s &quot;model map&quot; feature </span></div>
<div class="line"><span class="stringliteral">to provide custom behavior for unrelated types using traits.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/P7rfbzecj)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&lt;a name=&quot;showcase3&quot;&gt;&lt;/a&gt; </span></div>
<div class="line"><span class="stringliteral">### Showcase 3: *Any++* Open Multi Dispatch, (Type Erased Binary Operator)</span></div>
<div class="line"><span class="stringliteral">```cpp</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">#if !defined(__clang__)  // clang makes no rewrite for our &lt;=&gt; operator :-(</span></div>
<div class="line"><span class="stringliteral">                         // gcc and msvc do!</span></div>
<div class="line"><span class="stringliteral">namespace showcase3 {</span></div>
<div class="line"><span class="stringliteral">#include &lt;bit_factory/anyxx.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;compare&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;string&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">namespace ayx = anyxx;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct circle {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string name() const { return &quot;circle&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">struct square {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string name() const { return &quot;square&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct figure_has_open_dispatch {};</span></div>
<div class="line"><span class="stringliteral">ANY(figure, (ANY_FN(std::string, name, (), const)), ayx::cref)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ayx::dispatch&lt;std::partial_ordering(ayx::virtual_&lt;any_figure&lt;&gt;&gt;,</span></div>
<div class="line"><span class="stringliteral">                                      ayx::virtual_&lt;any_figure&lt;&gt;&gt;)&gt;</span></div>
<div class="line"><span class="stringliteral">    compare_edges;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[[nodiscard]] std::partial_ordering operator&lt;=&gt;(any_figure&lt;&gt; const&amp; l,</span></div>
<div class="line"><span class="stringliteral">                                                any_figure&lt;&gt; const&amp; r) {</span></div>
<div class="line"><span class="stringliteral">  return compare_edges(l, r);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">auto __ = compare_edges.define&lt;circle, circle&gt;(</span></div>
<div class="line"><span class="stringliteral">    [](auto const&amp;, auto const&amp;) { return std::partial_ordering::equivalent; });</span></div>
<div class="line"><span class="stringliteral">auto __ = compare_edges.define&lt;circle, square&gt;(</span></div>
<div class="line"><span class="stringliteral">    [](auto const&amp;, auto const&amp;) { return std::partial_ordering::less; });</span></div>
<div class="line"><span class="stringliteral">auto __ = compare_edges.define&lt;square, square&gt;(</span></div>
<div class="line"><span class="stringliteral">    [](auto const&amp;, auto const&amp;) { return std::partial_ordering::equivalent; });</span></div>
<div class="line"><span class="stringliteral">auto __ = compare_edges.define&lt;square, circle&gt;(</span></div>
<div class="line"><span class="stringliteral">    [](auto const&amp;, auto const&amp;) { return std::partial_ordering::greater; });</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">void compare_each(std::stringstream&amp; os,</span></div>
<div class="line"><span class="stringliteral">                  std::vector&lt;ayx::any&lt;ayx::val, figure&gt;&gt; const&amp; figures) {</span></div>
<div class="line"><span class="stringliteral">  std::string sep;</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; l : figures)</span></div>
<div class="line"><span class="stringliteral">    for (auto const&amp; r : figures) {</span></div>
<div class="line"><span class="stringliteral">      os &lt;&lt; std::exchange(sep, &quot;, &quot;) &lt;&lt; l.name() &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><span class="stringliteral">      if (l == r)</span></div>
<div class="line"><span class="stringliteral">        os &lt;&lt; &quot;==&quot;;</span></div>
<div class="line"><span class="stringliteral">      else if (l &lt; r)</span></div>
<div class="line"><span class="stringliteral">        os &lt;&lt; &quot;&lt;&quot;;</span></div>
<div class="line"><span class="stringliteral">      else</span></div>
<div class="line"><span class="stringliteral">        os &lt;&lt; &quot;&gt;&quot;;</span></div>
<div class="line"><span class="stringliteral">      os &lt;&lt; &quot; &quot; &lt;&lt; r.name();</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TEST_CASE(&quot;Showcase3&quot;) {</span></div>
<div class="line"><span class="stringliteral">  std::stringstream ss;</span></div>
<div class="line"><span class="stringliteral">  compare_each(ss, {circle{}, square{}});</span></div>
<div class="line"><span class="stringliteral">  CHECK(ss.str() ==</span></div>
<div class="line"><span class="stringliteral">        &quot;circle == circle, circle &lt; square, square &gt; circle, square == square&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral">};  // namespace showcase3</span></div>
<div class="line"><span class="stringliteral">#endif  // __clang__</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#if 0</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">```</span></div>
<div class="line"><span class="stringliteral">Showcase 3 demonstrates how to use the Any++ library to implement open multi-dispatch (type-erased binary operators) in C++. In this example:</span></div>
<div class="line"><span class="stringliteral">- Two types, `circle` and `square`, are defined, each with a `name()` method.</span></div>
<div class="line"><span class="stringliteral">- A `figure` trait is declared using the `Any++` macro system, specifying a `name()` function.</span></div>
<div class="line"><span class="stringliteral">- The `ANY` macro is an extension of the `TRAIT` macro. It defines the requested behavior (trait interface) and additionally creates a typedef for an `any` </span></div>
<div class="line"><span class="stringliteral">  type, named `any_&lt;first parameter of macro&gt;`, that uses this trait. The generated trait itself has a template parameter for the Proxy type, </span></div>
<div class="line"><span class="stringliteral">  which is defaulted to the last parameter of the `ANY` macro.</span></div>
<div class="line"><span class="stringliteral">- The `dispatch&lt;R(Args...)&gt;` mechanism is used to define a type-erased, runtime-resolved binary operator (`operator&lt;=&gt;`) for comparing two `any_figure&lt;&gt;` objects.</span></div>
<div class="line"><span class="stringliteral">- The dispatch table is populated with custom comparison logic for each pair of types (`circle` vs `circle`, `circle` vs `square`, etc.) at static initialization time.</span></div>
<div class="line"><span class="stringliteral">To do this with as little ceremony as possible, ``anyxx.hpp`` provides a ``__`` macro that simulates the[C++26 placeholder with no name](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/p2169r4.pdf).</span></div>
<div class="line"><span class="stringliteral">That trick initializes a static variable with automatic name at each usage site with a dummy value, returned by ``declare`` only for this purpose.</span></div>
<div class="line"><span class="stringliteral">- The `compare_each` function iterates over all pairs of figures, compares them using the type-erased operator, and outputs the results.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/caTnh9cf1)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&lt;a name=&quot;showcase4&quot;&gt;&lt;/a&gt; </span></div>
<div class="line"><span class="stringliteral">### Showcase 4: *Any++* Open Dispatch As Visitor</span></div>
<div class="line"><span class="stringliteral">```cpp</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">namespace showcase4 {</span></div>
<div class="line"><span class="stringliteral">#include &lt;bit_factory/anyxx.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;string&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">namespace ayx = anyxx;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct circle {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string name() const { return &quot;circle&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">struct square {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string name() const { return &quot;square&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct figure_has_open_dispatch {};</span></div>
<div class="line"><span class="stringliteral">ANY(figure, (ANY_FN(std::string, name, (), const)), ayx::cref)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ayx::dispatch&lt;std::string(ayx::virtual_&lt;any_figure&lt;&gt;&gt;)&gt; latin, italian;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">auto __ = latin.define&lt;circle&gt;([](auto const&amp;) { return &quot;orbis&quot;; });</span></div>
<div class="line"><span class="stringliteral">auto __ = latin.define&lt;square&gt;([](auto const&amp;) { return &quot;quadratum&quot;; });</span></div>
<div class="line"><span class="stringliteral">auto __ = italian.define&lt;circle&gt;([](auto const&amp;) { return &quot;cerchio&quot;; });</span></div>
<div class="line"><span class="stringliteral">auto __ = italian.define&lt;square&gt;([](auto const&amp;) { return &quot;quadrato&quot;; });</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">void translate(std::stringstream&amp; os,</span></div>
<div class="line"><span class="stringliteral">               std::vector&lt;ayx::any&lt;ayx::val, figure&gt;&gt; const&amp; figures) {</span></div>
<div class="line"><span class="stringliteral">  std::string sep;</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; f : figures)</span></div>
<div class="line"><span class="stringliteral">    os &lt;&lt; std::exchange(sep, &quot;; &quot;) &lt;&lt; f.name() &lt;&lt; &quot;: latin = &quot; &lt;&lt; latin(f)</span></div>
<div class="line"><span class="stringliteral">       &lt;&lt; &quot;, italian = &quot; &lt;&lt; italian(f);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TEST_CASE(&quot;Showcase4&quot;) {</span></div>
<div class="line"><span class="stringliteral">  std::stringstream ss;</span></div>
<div class="line"><span class="stringliteral">  translate(ss, {circle{}, square{}});</span></div>
<div class="line"><span class="stringliteral">  CHECK(ss.str() ==</span></div>
<div class="line"><span class="stringliteral">        &quot;circle: latin = orbis, italian = cerchio; square: latin = quadratum, &quot;</span></div>
<div class="line"><span class="stringliteral">        &quot;italian = quadrato&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral">};  // namespace showcase4</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#if 0</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">```</span></div>
<div class="line"><span class="stringliteral">Showcase 4 demonstrates how to use `Any++` to implement open dispatch in the style of a visitor pattern, enabling runtime selection of behavior for different types without inheritance or virtual functions.</span></div>
<div class="line"><span class="stringliteral">- Two types, `circle` and `square`, each provide a `name()` method.</span></div>
<div class="line"><span class="stringliteral">- A `figure` trait is defined, specifying the required interface.</span></div>
<div class="line"><span class="stringliteral">- Two open dispatchers, `latin` and `italian`, are created using `dispatch&lt;R(Args...)&gt;`, each mapping a figure to a localized string.</span></div>
<div class="line"><span class="stringliteral">- The dispatchers are populated with type-specific translations for `circle` and `square`.</span></div>
<div class="line"><span class="stringliteral">- The `translate` function iterates over a collection of type-erased figures, using the dispatchers to output the name and its translation in both Latin and Italian.</span></div>
<div class="line"><span class="stringliteral">This is the so-called &quot;Open Visitor Pattern&quot; implemented via open dispatch O(1) runtime complexity **without boilerplate**.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/c1eWsrdr7)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&lt;a name=&quot;showcase5&quot;&gt;&lt;/a&gt; </span></div>
<div class="line"><span class="stringliteral">### Showcase 5: *Any++* Crosscast + Factory = Serialization</span></div>
<div class="line"><span class="stringliteral">```cpp</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">namespace showcase5 {</span></div>
<div class="line"><span class="stringliteral">#include &lt;bit_factory/anyxx.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;string&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">namespace ayx = anyxx;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct circle {</span></div>
<div class="line"><span class="stringliteral">  double radius = 0.0;</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] double area() const { return radius * radius * 3.14; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">struct square {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] double area() const { return edge_length * edge_length; }</span></div>
<div class="line"><span class="stringliteral">  double edge_length = 0.0;</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct figure_has_open_dispatch {};</span></div>
<div class="line"><span class="stringliteral">ANY(figure, (ANY_FN(double, area, (), const)), ayx::val)</span></div>
<div class="line"><span class="stringliteral">ANY(serializable, (ANY_FN(void, serialize, (std::ostream&amp;), const)), ayx::val)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ayx::factory&lt;any_serializable, std::string, std::istream&amp;&gt; deserialize;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[[nodiscard]] any_figure&lt;&gt; deserialize_any_figure(std::istream&amp; archive) {</span></div>
<div class="line"><span class="stringliteral">  std::string type;</span></div>
<div class="line"><span class="stringliteral">  archive &gt;&gt; type;</span></div>
<div class="line"><span class="stringliteral">  return ayx::move_to&lt;any_figure&lt;&gt;&gt;(</span></div>
<div class="line"><span class="stringliteral">      deserialize.construct&lt;ayx::val&gt;(type, archive));</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ANY_MODEL_MAP((circle), serializable) {</span></div>
<div class="line"><span class="stringliteral">  static void serialize(circle const&amp; self, std::ostream&amp; os) {</span></div>
<div class="line"><span class="stringliteral">    os &lt;&lt; &quot;circle &quot; &lt;&lt; self.radius &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><span class="stringliteral">  };</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">auto __ = deserialize.register_(&quot;circle&quot;, [](std::istream&amp; archive) -&gt; circle {</span></div>
<div class="line"><span class="stringliteral">  circle c;</span></div>
<div class="line"><span class="stringliteral">  archive &gt;&gt; c.radius;</span></div>
<div class="line"><span class="stringliteral">  return c;</span></div>
<div class="line"><span class="stringliteral">});</span></div>
<div class="line"><span class="stringliteral">ANY_REGISTER_MODEL(circle, figure);</span></div>
<div class="line"><span class="stringliteral">ANY_REGISTER_MODEL(circle, serializable);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ANY_MODEL_MAP((square), serializable) {</span></div>
<div class="line"><span class="stringliteral">  static void serialize(square const&amp; self, std::ostream&amp; os) {</span></div>
<div class="line"><span class="stringliteral">    os &lt;&lt; &quot;square &quot; &lt;&lt; self.edge_length &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><span class="stringliteral">  };</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">auto __ = deserialize.register_(&quot;square&quot;, [](std::istream&amp; archive) {</span></div>
<div class="line"><span class="stringliteral">  square s;</span></div>
<div class="line"><span class="stringliteral">  archive &gt;&gt; s.edge_length;</span></div>
<div class="line"><span class="stringliteral">  return s;</span></div>
<div class="line"><span class="stringliteral">});</span></div>
<div class="line"><span class="stringliteral">ANY_REGISTER_MODEL(square, figure);</span></div>
<div class="line"><span class="stringliteral">ANY_REGISTER_MODEL(square, serializable);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">void areas(std::stringstream&amp; os,</span></div>
<div class="line"><span class="stringliteral">           std::vector&lt;ayx::any&lt;ayx::val, figure&gt;&gt; const&amp; figures) {</span></div>
<div class="line"><span class="stringliteral">  std::string sep;</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; f : figures) os &lt;&lt; std::exchange(sep, &quot;, &quot;) &lt;&lt; f.area();</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TEST_CASE(&quot;Showcase5&quot;) {</span></div>
<div class="line"><span class="stringliteral">  std::stringstream archive{&quot;: circle 1 : square 2 : circle 3 : circle 4 end&quot;};</span></div>
<div class="line"><span class="stringliteral">  std::vector&lt;any_figure&lt;&gt;&gt; figures;</span></div>
<div class="line"><span class="stringliteral">  std::string more;</span></div>
<div class="line"><span class="stringliteral">  for (archive &gt;&gt; more; more != &quot;end&quot;; archive &gt;&gt; more)</span></div>
<div class="line"><span class="stringliteral">    figures.push_back(deserialize_any_figure(archive));</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  std::stringstream ss;</span></div>
<div class="line"><span class="stringliteral">  areas(ss, figures);</span></div>
<div class="line"><span class="stringliteral">  CHECK(ss.str() == &quot;3.14, 4, 28.26, 50.24&quot;);</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  std::stringstream serialized;</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; f : figures) {</span></div>
<div class="line"><span class="stringliteral">    serialized &lt;&lt; &quot;: &quot;;</span></div>
<div class="line"><span class="stringliteral">    ayx::borrow_as&lt;any_serializable&lt;ayx::cref&gt;&gt;(f)-&gt;serialize(serialized);</span></div>
<div class="line"><span class="stringliteral">  }</span></div>
<div class="line"><span class="stringliteral">  serialized &lt;&lt; &quot;end&quot;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">  CHECK(serialized.str() == archive.str());</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral">};  // namespace showcase5</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#if 0</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">```</span></div>
<div class="line"><span class="stringliteral">Showcase 5 demonstrates how to use `Any++` to combine cross-casting and factory patterns for serialization and deserialization of type-erased objects.</span></div>
<div class="line"><span class="stringliteral">- Two types, `circle` and `square`, are defined, each with an `area()` method and serializable state (`radius` or `edge_length`).</span></div>
<div class="line"><span class="stringliteral">- Two traits are declared: `figure` (with an `area()` method) and `serializable` (with a `serialize(std::ostream&amp;)` method).</span></div>
<div class="line"><span class="stringliteral">- A factory (`deserialize`) is created to construct type-erased `any_serializable` objects from a type name and an input stream.</span></div>
<div class="line"><span class="stringliteral">- Model maps provide custom serialization logic for each type.</span></div>
<div class="line"><span class="stringliteral">- The `deserialize_any_figure` function reads a type name from the stream, uses the factory to construct the correct type, and cross-casts it to a figure.</span></div>
<div class="line"><span class="stringliteral">- The test case deserializes a sequence of shapes from a stream, computes their areas, serializes them back, and checks that the serialization matches the original input.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">Summary:</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">This example shows how `Any++` enables runtime type selection, safe cross-casting between interfaces, and pluggable serialization logic for unrelated types, all using type-erased objects and open extension points.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/4r5o6en94)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&lt;a name=&quot;showcase6&quot;&gt;&lt;/a&gt; </span></div>
<div class="line"><span class="stringliteral">### Showcase 6: Basic *Any++* std::variant usage</span></div>
<div class="line"><span class="stringliteral">```cpp</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;bit_factory/anyxx.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;string&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">namespace showcase6 {</span></div>
<div class="line"><span class="stringliteral">struct circle {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string draw() const { return &quot;Hello&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">struct square {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string draw() const { return &quot;World&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TRAIT(drawable, (ANY_FN(std::string, draw, (), const)))</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">using known_shapes = std::variant&lt;circle, square&gt;;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">void draw(std::stringstream&amp; os,</span></div>
<div class="line"><span class="stringliteral">          std::vector&lt;anyxx::any&lt;anyxx::by_val&lt;known_shapes&gt;, drawable&gt;&gt; const&amp;</span></div>
<div class="line"><span class="stringliteral">              drawables) {</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TEST_CASE(&quot;Showcase6&quot;) {</span></div>
<div class="line"><span class="stringliteral">  std::stringstream ss;</span></div>
<div class="line"><span class="stringliteral">  draw(ss, {circle{}, square{}});</span></div>
<div class="line"><span class="stringliteral">  CHECK(ss.str() == &quot;Hello\nWorld\n&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral">}  // namespace showcase6</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#if 0</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">```</span></div>
<div class="line"><span class="stringliteral">Showcase 6 demonstrates how to use `Any++` with `std::variant` to enable type-erased polymorphism over a fixed set of types.</span></div>
<div class="line"><span class="stringliteral">- Two types, `circle` and `square`, are defined, each with a `draw()` method returning a string.</span></div>
<div class="line"><span class="stringliteral">- A `drawable` trait is declared, specifying the required interface (`draw() const -&gt; std::string`).</span></div>
<div class="line"><span class="stringliteral">- A `known_shapes` type alias is defined as `std::variant&lt;circle, square&gt;`, representing a closed set of possible shapes.</span></div>
<div class="line"><span class="stringliteral">- The function `draw` takes a vector of type-erased objects (`anyxx::any&lt;anyxx::by_val&lt;known_shapes&gt;, drawable&gt;`) and calls `draw()` on each, writing the results to a stringstream.</span></div>
<div class="line"><span class="stringliteral">- The Catch2 test verifies that drawing a `circle` and a `square` produces the expected output.</span></div>
<div class="line"><span class="stringliteral">This example shows how `Any++` can be combined with `std::variant` to provide type-erased, trait-based polymorphism for a known set of types, allowing heterogeneous collections and uniform interface access without inheritance or virtual functions.</span></div>
<div class="line"><span class="stringliteral">Because the set of types is fixed, this approach can offer better performance than fully dynamic type erasure while still providing flexibility and extensibility through traits.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/5EYKa4daK)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&lt;a name=&quot;showcase7&quot;&gt;&lt;/a&gt; </span></div>
<div class="line"><span class="stringliteral">### Showcase 7: Basic *Any++* open std::variant usage: &#39;</span>vany<span class="stringliteral">&#39;</span></div>
<div class="line"><span class="stringliteral">```cpp</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;bit_factory/anyxx.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="stringliteral">#include &lt;string&gt;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">namespace showcase7 {</span></div>
<div class="line"><span class="stringliteral">namespace ayx = anyxx;</span></div>
<div class="line"><span class="stringliteral">using namespace std::string_literals;</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">struct circle {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string draw() const { return &quot;Hello&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral">struct square {</span></div>
<div class="line"><span class="stringliteral">  [[nodiscard]] std::string draw() const { return &quot;World&quot;; }</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">ANY(figure, (ANY_FN(std::string, draw, (), const)), ayx::val)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">using known_and_unknown_shapes =</span></div>
<div class="line"><span class="stringliteral">    ayx::make_vany&lt;any_figure, ayx::val, circle, square&gt;;</span></div>
<div class="line"><span class="stringliteral">static_assert(</span></div>
<div class="line"><span class="stringliteral">    std::same_as&lt;known_and_unknown_shapes,</span></div>
<div class="line"><span class="stringliteral">                 any_figure&lt;ayx::by_val&lt;  // see the Any++ logo at the top</span></div>
<div class="line"><span class="stringliteral">                     std::variant&lt;any_figure&lt;ayx::val&gt;, circle, square&gt;&gt;&gt;&gt;);</span></div>
<div class="line"><span class="stringliteral">ANY_MODEL_MAP((std::string), figure) {</span></div>
<div class="line"><span class="stringliteral">  static std::string draw(std::string const&amp; s) { return s; };</span></div>
<div class="line"><span class="stringliteral">};</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">void draw(std::stringstream&amp; os,</span></div>
<div class="line"><span class="stringliteral">          std::vector&lt;known_and_unknown_shapes&gt; const&amp; figures) {</span></div>
<div class="line"><span class="stringliteral">  for (auto const&amp; f : figures) os &lt;&lt; f.draw() &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">TEST_CASE(&quot;Showcase7&quot;) {</span></div>
<div class="line"><span class="stringliteral">  std::stringstream ss;</span></div>
<div class="line"><span class="stringliteral">  draw(ss, {circle{}, square{}, any_figure&lt;&gt;{&quot;The big unknown...&quot;s}});</span></div>
<div class="line"><span class="stringliteral">  CHECK(ss.str() == &quot;Hello\nWorld\nThe big unknown...\n&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral">}  // namespace showcase7</span></div>
<div class="line"><span class="stringliteral">// &lt;!--</span></div>
<div class="line"><span class="stringliteral">#if 0</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="line"><span class="stringliteral">```</span></div>
<div class="line"><span class="stringliteral">Showcase 7 demonstrates how to use `Any++` to combine open type erasure with `std::variant` for extensible,</span></div>
<div class="line"><span class="stringliteral">heterogeneous collections. Let us call them &quot;vany&quot; (variant-any).</span></div>
<div class="line"><span class="stringliteral">- Two types, `circle` and `square`, are defined, each with a `draw()` method returning a string.</span></div>
<div class="line"><span class="stringliteral">- A `figure` trait is declared, specifying the required interface (`draw() const -&gt; std::string`).</span></div>
<div class="line"><span class="stringliteral">- The type alias `known_and_unknown_shapes` is created using `anyxx::make_vany`, which produces a type-erased wrapper over a `std::variant` containing:</span></div>
<div class="line"><span class="stringliteral">  - All known types (`circle`, `square`)</span></div>
<div class="line"><span class="stringliteral">  - An open-ended type-erased fallback (`any_figure&lt;ayx::val&gt;`)</span></div>
<div class="line"><span class="stringliteral">- A model map is provided for `std::string`, allowing strings to be handled as figures.</span></div>
<div class="line"><span class="stringliteral">- So the vector passed to `draw` can seamlessly contain both known types (like `circle` and `square`) and dynamically extended types (like `std::string`), all accessed through the same trait-based interface. </span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">This example shows how `Any++` enables a hybrid approach: you get the performance of `std::variant` for known types, </span></div>
<div class="line"><span class="stringliteral">while still supporting open-ended extension with type-erased objects. This is useful for scenarios where you want </span></div>
<div class="line"><span class="stringliteral">to handle a fixed set of types efficiently, but also allow for runtime extension or plugin types, all through a uniform trait-based interface.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">&quot;vany&quot; is a modern, safer, and extensible ~~variant~~ version of OLEVariant and QVariant.</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">[Compiler Explorer](https://godbolt.org/z/saWMv3brz)</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">If you are still here, you are ready for [more Examples](https://www.alexweb.io/anyxx/examples.html)</span></div>
<div class="line"><span class="stringliteral">&lt;!--</span></div>
<div class="line"><span class="stringliteral">#endif</span></div>
<div class="line"><span class="stringliteral">// --&gt;</span></div>
<div class="ttc" id="aanyxx_8hpp_html"><div class="ttname"><a href="anyxx_8hpp.html">anyxx.hpp</a></div><div class="ttdoc">C++ header only library for external polymorphism.</div></div>
<div class="ttc" id="agroup__fn__macros_html_ga6a5835dfafdaede08be54515be1208a8"><div class="ttname"><a href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a></div><div class="ttdeci">#define ANY_FN(ret, name, params, const_)</div><div class="ttdoc">TRAIT function whose default behavior is to call an equally named member function of the model.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:755</div></div>
<div class="ttc" id="agroup__model__map__macros_html_gaa11989a5b380318c70cc1a59a8642384"><div class="ttname"><a href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a></div><div class="ttdeci">#define ANY_MODEL_MAP(model_, trait_)</div><div class="ttdoc">ANY_MODEL_MAP macro.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:883</div></div>
<div class="ttc" id="agroup__trait__macros_html_gae0cb5618c6b82d8f6a7eaf36143647a9"><div class="ttname"><a href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a></div><div class="ttdeci">#define TRAIT(n, fns)</div><div class="ttdoc">Macro to define the functional behavior for an any.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:526</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
