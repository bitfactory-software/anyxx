<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Any++: Any++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Any++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Any++ </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README__for__doxygen_2README"></a> //                              <a class="el" href="#showcase1" title="showcase1">Hello World!</a> / <a class="el" href="#showcase2" title="showcase2">Model Map</a> / <a class="el" href="#showcase3" title="showcase3">Type Erased Spaceship</a> / <a class="el" href="#showcase4" title="showcase4">Open Dispatch As Visiitor</a> / <a class="el" href="#showcase5" title="showcase5">Crosscast + Factory = Serialization</a> / <a class="el" href="#showcase6" title="showcase6">Basic *Any++* std::variant usage</a> / <a class="el" href="#showcase7" title="showcase7">Basic *Any++* open std::variant usage: 'vany'</a></p>
<p><a href="https://opensource.org/license/mit"><img src="http://img.shields.io/badge/license-MIT-blue.svg" alt="MIT Licence" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/bitfactory-software/anyxx/actions/workflows/ci.yml"><img src="https://github.com/bitfactory-software/anyxx/actions/workflows/ci.yml/badge.svg" alt="CI" style="pointer-events: none;" class="inline"/></a> <a href="https://www.alexweb.io/anyxx/"><img src="https://img.shields.io/badge/dos-Any%2B%2B-blue" alt="Static Badge" class="inline"/></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Any++ : How to <span class="tt">trait</span> <span class="tt">any</span> <span class="tt">virtual</span>, <span class="tt">static</span> or <span class="tt">variant</span>?</h1>
<p><img src="https://github.com/user-attachments/assets/e4766dd4-7a21-486d-9dd0-8725149e0754" alt="Any++logo-small" width="908" height="760" class="inline"/></p>
<p><b>Any++</b> enhances the well-known <em>boost::any</em> and <em>std::any</em> with:</p>
<ul>
<li><b>Flexible choice of underlying storage mechanisms</b><ul>
<li>Type-erased</li>
<li>Concrete</li>
<li>Variant</li>
</ul>
</li>
<li><b>Extensibility</b><ul>
<li>Ability to add functions and operators using Rust-like <b>traits</b> (including templates)</li>
<li>Support for <b>open (multi-)dispatch</b></li>
<li>Runtime support for <b>downcasts and cross-casts</b></li>
</ul>
</li>
</ul>
<p>To allow easy <b>separation of concerns</b>, the library adds utilities for:</p><ul>
<li>Factories</li>
<li>Hooks</li>
<li>Load-time extendable members</li>
</ul>
<p>The performance of <b>dynamic dispatch is on par with virtual functions</b>.</p>
<p>The combination of static and dynamic dispatch enables</p><ul>
<li>a hybrid usage of <span class="tt">std::variant</span> and <b>type erasure</b> to balance performance and coupling.</li>
<li>C++0x-like concept maps for static and dynamic customization points and default behavior.</li>
</ul>
<p><a class="anchor" id="showcase1"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
Showcase 1: Basic <em>Any++</em> usage</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>showcase1 {</div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hello&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a>(drawable, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)))</div>
<div class="line"> </div>
<div class="line">void draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;anyxx::any&lt;anyxx::val, drawable&gt;&gt; const&amp; drawables) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase1&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Hello\nWorld\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">}  <span class="comment">// namespace showcase1</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="ttc" id="aanyxx_8hpp_html"><div class="ttname"><a href="anyxx_8hpp.html">anyxx.hpp</a></div><div class="ttdoc">C++ header only library for external polymorphism.</div></div>
<div class="ttc" id="agroup__fn__macros_html_ga6a5835dfafdaede08be54515be1208a8"><div class="ttname"><a href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a></div><div class="ttdeci">#define ANY_FN(ret, name, params, const_)</div><div class="ttdoc">TRAIT function whose default behavior is to call an equally named member function of the model.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:755</div></div>
<div class="ttc" id="agroup__trait__macros_html_gae0cb5618c6b82d8f6a7eaf36143647a9"><div class="ttname"><a href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a></div><div class="ttdeci">#define TRAIT(n, fns)</div><div class="ttdoc">Macro to define the functional behavior for an any.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:526</div></div>
</div><!-- fragment --><p> Showcase 1 demonstrates the most basic usage of the Any++ library for type-erased polymorphism in C++. It defines two simple types, circle and square, each with a draw() method returning a string. Using the Any++ macro system, a drawable trait is declared, specifying the required interface (draw() const -&gt; std::string).</p>
<p>The draw function takes a vector of type-erased any objects that conform to the drawable trait. It shows how to create and use a heterogeneous collection of unrelated objects (circle and square).</p>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="el" href="#showcase2" title="showcase2">More Showcases here...</a> <a href="https://www.alexweb.io/anyxx/">Docs</a></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Available via vcpkg</h3>
<h3 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Useage in CMakeLists.txt:</h3>
<div class="fragment"><div class="line">FetchContent_Declare(</div>
<div class="line">    bit_factory::anyxx</div>
<div class="line">    GIT_REPOSITORY C</div>
<div class="line">    GIT_TAG main</div>
<div class="line">)</div>
<div class="line">FetchContent_MakeAvailable(anyxx)</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md28"></a>
Clone the repo:</h3>
<div class="fragment"><div class="line">git clone -c core.symlinks=true git clone -c core.symlinks=true &lt;repo-url&gt;</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md29"></a>
Performace compared</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Benchmark  </th><th class="markdownTableHeadRight">12th Gen Intel(R)<br  />
Core(TM) i12900H (2.50 GHz)<br  />
MS Visual C++ 18.0.1 /O2 /Ob2  </th><th class="markdownTableHeadRight">AMD Ryzen 9<br  />
 5900X 12-Core Processor (3.70 GHz)<br  />
MS Visual C++ 17.14.14 /O2 /Ob2  </th><th class="markdownTableHeadRight">12th Gen Intel(R)<br  />
Core(TM) i12900H (2.50 GHz)<br  />
clang-cl /O2 /Ob2  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>Single dispatch</b>  </td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyRight"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">virtual function (reference*)  </td><td class="markdownTableBodyRight">100%  </td><td class="markdownTableBodyRight">100%  </td><td class="markdownTableBodyRight">100%  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">any++ interface  </td><td class="markdownTableBodyRight"><b>100%</b>  </td><td class="markdownTableBodyRight"><b>100%</b>  </td><td class="markdownTableBodyRight"><b>100%</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">any++ open method  </td><td class="markdownTableBodyRight"><b>115%</b>  </td><td class="markdownTableBodyRight"><b>200%</b>  </td><td class="markdownTableBodyRight"><b>130%</b>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>Double dispatch</b>  </td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyRight"></td><td class="markdownTableBodyRight"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">std::variant + std::visit (reference*)  </td><td class="markdownTableBodyRight">100%  </td><td class="markdownTableBodyRight">100%  </td><td class="markdownTableBodyRight">100%  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">hand rolled w. virtual function  </td><td class="markdownTableBodyRight">150%  </td><td class="markdownTableBodyRight">150%  </td><td class="markdownTableBodyRight">400%  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">any++ open method  </td><td class="markdownTableBodyRight"><b>120%</b>  </td><td class="markdownTableBodyRight"><b>150%</b>  </td><td class="markdownTableBodyRight"><b>300%</b>(*)  </td></tr>
</table>
<ul>
<li>reference*:<ul>
<li>100% in different colums do not compare<br  />
</li>
<li>100% <b>Single dispatch</b> does not compare to 100% <b>Double dispatch</b></li>
</ul>
</li>
<li>any++ open method vs std::variant + std::visit with clang:<ul>
<li>the meassured time with std::varaint/std::visit multidispatch on clang is 40%(!) from the MS Visual C++ result.</li>
</ul>
</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md30"></a>
CI Matrix</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">OS \ Compiler  </th><th class="markdownTableHeadCenter">MSVC  </th><th class="markdownTableHeadCenter">Clang  </th><th class="markdownTableHeadCenter">GCC  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Windows(latest)  </td><td class="markdownTableBodyCenter">19  </td><td class="markdownTableBodyCenter">21  </td><td class="markdownTableBodyCenter">-  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Ubuntu(latest)  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">21  </td><td class="markdownTableBodyCenter">14  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">MacOS(latest)  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">21  </td><td class="markdownTableBodyCenter">14  </td></tr>
</table>
<p><a class="anchor" id="showcase2"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md31"></a>
Showcase 2: <em>Any++</em> with Model Map</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>showcase2 {</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string edgy_salute()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;edgy World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a>(drawable, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)))</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((circle), drawable) {</div>
<div class="line">  <span class="keyword">static</span> std::string draw(circle <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;Silent greetings&quot;</span>; };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((square), drawable) {</div>
<div class="line">  <span class="keyword">static</span> std::string draw(square <span class="keyword">const</span>&amp; self) { <span class="keywordflow">return</span> self.edgy_salute(); };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;anyxx::any&lt;anyxx::val, drawable&gt;&gt; <span class="keyword">const</span>&amp; drawables) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase2&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Silent greetings\nedgy World\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">};  <span class="comment">// namespace showcase2</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="ttc" id="agroup__model__map__macros_html_gaa11989a5b380318c70cc1a59a8642384"><div class="ttname"><a href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a></div><div class="ttdeci">#define ANY_MODEL_MAP(model_, trait_)</div><div class="ttdoc">ANY_MODEL_MAP macro.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:883</div></div>
</div><!-- fragment --><p> Showcase 2 demonstrates, how to use the <span class="tt">Any++</span> library's "model map" feature to provide custom behavior for different types using traits, whitch have nothing in common.</p>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="anchor" id="showcase3"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md32"></a>
Showcase 3: <em>Any++</em> Open Multi Dispatch, (Type Erased Binary Operator)</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="preprocessor">#if !defined(__clang__)  </span><span class="comment">// clang makes no rewrite for our &lt;=&gt; operator :-(</span></div>
<div class="line">                         <span class="comment">// gcc and msvc do!</span></div>
<div class="line"><span class="keyword">namespace </span>showcase3 {</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;compare&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>ayx = anyxx;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  [[nodiscard]] std::string name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;circle&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;square&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>figure_has_open_dispatch {};</div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a>(figure, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, name, (), <span class="keyword">const</span>)), ayx::cref)</div>
<div class="line"> </div>
<div class="line">anyxx::dispatch&lt;std::partial_ordering(ayx::virtual_&lt;any_figure&lt;&gt;&gt;,</div>
<div class="line">                                      ayx::virtual_&lt;any_figure&lt;&gt;&gt;)&gt;</div>
<div class="line">    comapare_edges;</div>
<div class="line"> </div>
<div class="line">[[nodiscard]] std::partial_ordering operator&lt;=&gt;(any_figure&lt;&gt; <span class="keyword">const</span>&amp; l,</div>
<div class="line">                                                any_figure&lt;&gt; <span class="keyword">const</span>&amp; r) {</div>
<div class="line">  <span class="keywordflow">return</span> comapare_edges(l, r);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> __ = comapare_edges.define&lt;circle, circle&gt;(</div>
<div class="line">    [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;, <span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> std::partial_ordering::equivalent; });</div>
<div class="line"><span class="keyword">auto</span> __ = comapare_edges.define&lt;circle, square&gt;(</div>
<div class="line">    [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;, <span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> std::partial_ordering::less; });</div>
<div class="line"><span class="keyword">auto</span> __ = comapare_edges.define&lt;square, square&gt;(</div>
<div class="line">    [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;, <span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> std::partial_ordering::equivalent; });</div>
<div class="line"><span class="keyword">auto</span> __ = comapare_edges.define&lt;square, circle&gt;(</div>
<div class="line">    [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;, <span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> std::partial_ordering::greater; });</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> compare_each(std::stringstream&amp; os,</div>
<div class="line">                  std::vector&lt;anyxx::any&lt;anyxx::val, figure&gt;&gt; <span class="keyword">const</span>&amp; figures) {</div>
<div class="line">  std::string sep;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; l : figures)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; r : figures) {</div>
<div class="line">      os &lt;&lt; std::exchange(sep, <span class="stringliteral">&quot;, &quot;</span>) &lt;&lt; l.name() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (l == r)</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;==&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l &lt; r)</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;&lt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;&gt;&quot;</span>;</div>
<div class="line">      os &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; r.name();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase3&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  compare_each(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() ==</div>
<div class="line">        <span class="stringliteral">&quot;circle == circle, circle &lt; square, square &gt; circle, square == square&quot;</span>);</div>
<div class="line">}</div>
<div class="line">};  <span class="comment">// namespace showcase3</span></div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">// __clang__</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="ttc" id="agroup__trait__macros_html_ga47a5ba38b03d55fa5f63979281028d22"><div class="ttname"><a href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a></div><div class="ttdeci">#define ANY(n, l,...)</div><div class="ttdoc">Simple ANY macro.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:631</div></div>
</div><!-- fragment --><p> Showcase 3 demonstrates how to use the Any++ library to implement open multi-dispatch (type-erased binary operators) in C++. In this example:</p><ul>
<li>Two types, circle and square, are defined, each with a name() method.</li>
<li>A figure trait is declared using the Any++ macro system, specifying a name() function.</li>
<li>The dispatch&lt;R(Args...)&gt; mechanism is used to define a type-erased, runtime-resolved binary operator (operator&lt;=&gt;) for comparing two any_figure&lt;&gt; objects.</li>
<li>The dispatch table is populated with custom comparison logic for each pair of types (circle vs circle, circle vs square, etc.), returning the appropriate std::partial_ordering result.</li>
<li>The compare_each function iterates over all pairs of figures, compares them using the type-erased operator, and outputs the results.</li>
</ul>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="anchor" id="showcase4"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md33"></a>
Showcase 4: <em>Any++</em> Open Dispatch As Visiitor</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>showcase4 {</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>ayx = anyxx;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  [[nodiscard]] std::string name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;circle&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string name()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;square&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>figure_has_open_dispatch {};</div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a>(figure, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, name, (), <span class="keyword">const</span>)), ayx::cref)</div>
<div class="line"> </div>
<div class="line">anyxx::dispatch&lt;std::string(ayx::virtual_&lt;any_figure&lt;&gt;&gt;)&gt; latin, italian;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> __ = latin.define&lt;circle&gt;([](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;orbis&quot;</span>; });</div>
<div class="line"><span class="keyword">auto</span> __ = latin.define&lt;square&gt;([](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;quadratum&quot;</span>; });</div>
<div class="line"><span class="keyword">auto</span> __ = italian.define&lt;circle&gt;([](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;cerchio&quot;</span>; });</div>
<div class="line"><span class="keyword">auto</span> __ = italian.define&lt;square&gt;([](<span class="keyword">auto</span> <span class="keyword">const</span>&amp;) { <span class="keywordflow">return</span> <span class="stringliteral">&quot;quadrato&quot;</span>; });</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> translate(std::stringstream&amp; os,</div>
<div class="line">               std::vector&lt;anyxx::any&lt;anyxx::val, figure&gt;&gt; <span class="keyword">const</span>&amp; figures) {</div>
<div class="line">  std::string sep;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; f : figures)</div>
<div class="line">    os &lt;&lt; std::exchange(sep, <span class="stringliteral">&quot;; &quot;</span>) &lt;&lt; f.name() &lt;&lt; <span class="stringliteral">&quot;: latin = &quot;</span> &lt;&lt; latin(f)</div>
<div class="line">       &lt;&lt; <span class="stringliteral">&quot;, italian = &quot;</span> &lt;&lt; italian(f);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase4&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  translate(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() ==</div>
<div class="line">        <span class="stringliteral">&quot;circle: latin = orbis, italian = cerchio; square: latin = quadratum, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;italian = quadrato&quot;</span>);</div>
<div class="line">}</div>
<div class="line">};  <span class="comment">// namespace showcase4</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
</div><!-- fragment --><p> Showcase 4 demonstrates how to use the Any++ library to implement open dispatch in the style of a visitor pattern, enabling runtime selection of behavior for different types without inheritance or virtual functions.</p><ul>
<li>Two types, circle and square, each provide a name() method.</li>
<li>A figure trait is defined, specifying the required interface.</li>
<li>Two open dispatchers, latin and italian, are created using dispatch&lt;R(Args...)&gt;, each mapping a figure to a localized string.</li>
<li>The dispatchers are populated with type-specific translations for circle and square.</li>
<li>The translate function iterates over a collection of type-erased figures, using the dispatchers to output the name and its translation in both Latin and Italian. This is the so called "Open Visitor Pattern" implemented via open dispatch O(1) runtime complexity <b>without boilerplate</b>.</li>
</ul>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="anchor" id="showcase5"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md34"></a>
Showcase 5: <em>Any++</em> Crosscast + Factory = Serialization</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>showcase5 {</div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>ayx = anyxx;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  <span class="keywordtype">double</span> radius = 0.0;</div>
<div class="line">  [[nodiscard]] <span class="keywordtype">double</span> area()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> radius * radius * 3.14; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] <span class="keywordtype">double</span> area()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> edge_length * edge_length; }</div>
<div class="line">  <span class="keywordtype">double</span> edge_length = 0.0;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>figure_has_open_dispatch {};</div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a>(figure, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(<span class="keywordtype">double</span>, area, (), <span class="keyword">const</span>)), ayx::val)</div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a>(serializeable, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(<span class="keywordtype">void</span>, serialize, (std::ostream&amp;), <span class="keyword">const</span>)), ayx::val)</div>
<div class="line"> </div>
<div class="line">ayx::factory&lt;any_serializeable, std::string, std::istream&amp;&gt; deserialize;</div>
<div class="line"> </div>
<div class="line">[[nodiscard]] any_figure&lt;&gt; deserialize_any_figure(std::istream&amp; archive) {</div>
<div class="line">  std::string type;</div>
<div class="line">  archive &gt;&gt; type;</div>
<div class="line">  <span class="keywordflow">return</span> ayx::move_to&lt;any_figure&lt;&gt;&gt;(</div>
<div class="line">      deserialize.construct&lt;ayx::val&gt;(type, archive));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((circle), serializeable) {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> serialize(circle <span class="keyword">const</span>&amp; self, std::ostream&amp; os) {</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;circle &quot;</span> &lt;&lt; self.radius &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"><span class="keyword">auto</span> __ = deserialize.register_(<span class="stringliteral">&quot;circle&quot;</span>, [](std::istream&amp; archive) -&gt; circle {</div>
<div class="line">  circle c;</div>
<div class="line">  archive &gt;&gt; c.radius;</div>
<div class="line">  <span class="keywordflow">return</span> c;</div>
<div class="line">});</div>
<div class="line"><a class="code hl_define" href="group__meta__class__macros.html#ga3449a1cb25287d73a1e8db0fe95f2dac">ANY_REGISTER_MODEL</a>(circle, figure);</div>
<div class="line"><a class="code hl_define" href="group__meta__class__macros.html#ga3449a1cb25287d73a1e8db0fe95f2dac">ANY_REGISTER_MODEL</a>(circle, serializeable);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((square), serializeable) {</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">void</span> serialize(square <span class="keyword">const</span>&amp; self, std::ostream&amp; os) {</div>
<div class="line">    os &lt;&lt; <span class="stringliteral">&quot;square &quot;</span> &lt;&lt; self.edge_length &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">  };</div>
<div class="line">};</div>
<div class="line"><span class="keyword">auto</span> __ = deserialize.register_(<span class="stringliteral">&quot;square&quot;</span>, [](std::istream&amp; archive) {</div>
<div class="line">  square s;</div>
<div class="line">  archive &gt;&gt; s.edge_length;</div>
<div class="line">  <span class="keywordflow">return</span> s;</div>
<div class="line">});</div>
<div class="line"><a class="code hl_define" href="group__meta__class__macros.html#ga3449a1cb25287d73a1e8db0fe95f2dac">ANY_REGISTER_MODEL</a>(square, figure);</div>
<div class="line"><a class="code hl_define" href="group__meta__class__macros.html#ga3449a1cb25287d73a1e8db0fe95f2dac">ANY_REGISTER_MODEL</a>(square, serializeable);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> areas(std::stringstream&amp; os,</div>
<div class="line">           std::vector&lt;anyxx::any&lt;anyxx::val, figure&gt;&gt; <span class="keyword">const</span>&amp; figures) {</div>
<div class="line">  std::string sep;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; f : figures) os &lt;&lt; std::exchange(sep, <span class="stringliteral">&quot;, &quot;</span>) &lt;&lt; f.area();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase5&quot;</span>) {</div>
<div class="line">  std::stringstream archive{<span class="stringliteral">&quot;: circle 1 : square 2 : circle 3 : circle 4 end&quot;</span>};</div>
<div class="line">  std::vector&lt;any_figure&lt;&gt;&gt; figures;</div>
<div class="line">  std::string more;</div>
<div class="line">  <span class="keywordflow">for</span> (archive &gt;&gt; more; more != <span class="stringliteral">&quot;end&quot;</span>; archive &gt;&gt; more)</div>
<div class="line">    figures.push_back(deserialize_any_figure(archive));</div>
<div class="line"> </div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  areas(ss, figures);</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;3.14, 4, 28.26, 50.24&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  std::stringstream serialized;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; f : figures) {</div>
<div class="line">    serialized &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div>
<div class="line">    anyxx::borrow_as&lt;any_serializeable&lt;anyxx::cref&gt;&gt;(f)-&gt;serialize(serialized);</div>
<div class="line">  }</div>
<div class="line">  serialized &lt;&lt; <span class="stringliteral">&quot;end&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  CHECK(serialized.str() == archive.str());</div>
<div class="line">}</div>
<div class="line">};  <span class="comment">// namespace showcase5</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="ttc" id="agroup__meta__class__macros_html_ga3449a1cb25287d73a1e8db0fe95f2dac"><div class="ttname"><a href="group__meta__class__macros.html#ga3449a1cb25287d73a1e8db0fe95f2dac">ANY_REGISTER_MODEL</a></div><div class="ttdeci">#define ANY_REGISTER_MODEL(class_, interface_,...)</div><div class="ttdoc">Register a model class for a specific any interface. Must be in global namespace.</div><div class="ttdef"><b>Definition</b> anyxx.hpp:3815</div></div>
</div><!-- fragment --><p> Showcase 5 demonstrates how to use the Any++ library to combine cross-casting and factory patterns for serialization and deserialization of type-erased objects.</p><ul>
<li>Two types, circle and square, are defined, each with an area() method and serializable state (radius or edge_length).</li>
<li>Two traits are declared: figure (with an area() method) and serializeable (with a serialize(std::ostream&amp;) method).</li>
<li>A factory (deserialize) is created to construct type-erased any_serializeable objects from a type name and an input stream.</li>
<li>Model maps provide custom serialization logic for each type.</li>
<li>The deserialize_any_figure function reads a type name from the stream, uses the factory to construct the correct type, and cross-casts it to a figure.</li>
<li>The test case deserializes a sequence of shapes from a stream, computes their areas, serializes them back, and checks that the serialization matches the original input. Summary: This example shows how Any++ enables runtime type selection, safe cross-casting between interfaces, and pluggable serialization logic for unrelated types, all using type-erased objects and open extension points.</li>
</ul>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="anchor" id="showcase6"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md35"></a>
Showcase 6: Basic <em>Any++</em> std::variant usage</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>showcase6 {</div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hello&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#gae0cb5618c6b82d8f6a7eaf36143647a9">TRAIT</a>(drawable, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)))</div>
<div class="line"> </div>
<div class="line">using known_shapes = std::variant&lt;circle, square&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;anyxx::any&lt;anyxx::by_val&lt;known_shapes&gt;, drawable&gt;&gt; const&amp;</div>
<div class="line">              drawables) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; drawable : drawables) os &lt;&lt; drawable.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase6&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Hello\nWorld\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">}  <span class="comment">// namespace showcase6</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
</div><!-- fragment --><p> Showcase 6 demonstrates how to use the Any++ library with <span class="tt">std::variant</span> to enable type-erased polymorphism over a fixed set of types.</p><ul>
<li>Two types, <span class="tt">circle</span> and <span class="tt">square</span>, are defined, each with a <span class="tt">draw()</span> method returning a string.</li>
<li>A <span class="tt">drawable</span> trait is declared, specifying the required interface (<span class="tt">draw() const -&gt; std::string</span>).</li>
<li>A <span class="tt">known_shapes</span> type alias is defined as <span class="tt">std::variant&lt;circle, square&gt;</span>, representing a closed set of possible shapes.</li>
<li>The function <span class="tt">draw</span> takes a vector of type-erased objects (<span class="tt"><a class="el" href="classanyxx_1_1any.html" title="The core class template to control dispatch for external polymorphism.">anyxx::any</a>&lt;<a class="el" href="structanyxx_1_1by__val.html">anyxx::by_val</a>&lt;known_shapes&gt;, drawable&gt;</span>) and calls <span class="tt">draw()</span> on each, writing the results to a stringstream.</li>
<li>The Catch2 test verifies that drawing a <span class="tt">circle</span> and a <span class="tt">square</span> produces the expected output. This example shows how Any++ can be combined with <span class="tt">std::variant</span> to provide type-erased, trait-based polymorphism for a known set of types, allowing heterogeneous collections and uniform interface access without inheritance or virtual functions. Because the set of types is fixed, this approach can offer better performance than fully dynamic type erasure while still providing flexibility and extensibility through traits.</li>
</ul>
<p>[Compiler Explorer] <b>TODO</b></p>
<p><a class="anchor" id="showcase7"></a> </p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md36"></a>
Showcase 7: Basic <em>Any++</em> open std::variant usage: 'vany'</h3>
<div class="fragment"><div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="anyxx_8hpp.html">bit_factory/anyxx.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;catch2/catch_test_macros.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>showcase7 {</div>
<div class="line"><span class="keyword">namespace </span>ayx = anyxx;</div>
<div class="line"><span class="keyword">using namespace </span>std::string_literals;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>circle {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;Hello&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>square {</div>
<div class="line">  [[nodiscard]] std::string draw()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <span class="stringliteral">&quot;World&quot;</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_define" href="group__trait__macros.html#ga47a5ba38b03d55fa5f63979281028d22">ANY</a>(figure, (<a class="code hl_define" href="group__fn__macros.html#ga6a5835dfafdaede08be54515be1208a8">ANY_FN</a>(std::string, draw, (), <span class="keyword">const</span>)), ayx::val)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>known_and_unknown_shapes =</div>
<div class="line">    anyxx::make_vany&lt;any_figure, ayx::val, circle, square&gt;;</div>
<div class="line"><span class="keyword">static_assert</span>(</div>
<div class="line">    std::same_as&lt;known_and_unknown_shapes,</div>
<div class="line">                 any_figure&lt;ayx::by_val&lt;  <span class="comment">// see the Any++ logo at the top</span></div>
<div class="line">                     std::variant&lt;any_figure&lt;ayx::val&gt;, circle, square&gt;&gt;&gt;&gt;);</div>
<div class="line"><a class="code hl_define" href="group__model__map__macros.html#gaa11989a5b380318c70cc1a59a8642384">ANY_MODEL_MAP</a>((std::string), figure) {</div>
<div class="line">  <span class="keyword">static</span> std::string draw(std::string <span class="keyword">const</span>&amp; s) { <span class="keywordflow">return</span> s; };</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> draw(std::stringstream&amp; os,</div>
<div class="line">          std::vector&lt;known_and_unknown_shapes&gt; <span class="keyword">const</span>&amp; figures) {</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; f : figures) os &lt;&lt; f.draw() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST_CASE(<span class="stringliteral">&quot;Showcase7&quot;</span>) {</div>
<div class="line">  std::stringstream ss;</div>
<div class="line">  draw(ss, {circle{}, square{}, any_figure&lt;&gt;{<span class="stringliteral">&quot;The big unknown...&quot;</span>s}});</div>
<div class="line">  CHECK(ss.str() == <span class="stringliteral">&quot;Hello\nWorld\nThe big unknown...\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line">}  <span class="comment">// namespace showcase7</span></div>
<div class="line"><span class="comment">// &lt;!--</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="comment">// --&gt;</span></div>
</div><!-- fragment --><p> Showcase 7 demonstrates how to use the Any++ library to combine open type erasure with <span class="tt">std::variant</span> for extensible, heterogeneous collections. Let us call them "vany" (variant-any).</p><ul>
<li>Two types, <span class="tt">circle</span> and <span class="tt">square</span>, are defined, each with a <span class="tt">draw()</span> method returning a string.</li>
<li>A <span class="tt">figure</span> trait is declared, specifying the required interface (<span class="tt">draw() const -&gt; std::string</span>).</li>
<li>The type alias <span class="tt">known_and_unknown_shapes</span> is created using <span class="tt"><a class="el" href="anyxx_8hpp.html#abb32933fc2d3ddd4236f3075dd5c1562" title="A factory type to direct get the any for the vany.">anyxx::make_vany</a></span>, which produces a type-erased wrapper over a <span class="tt">std::variant</span> containing:<ul>
<li>All known types (<span class="tt">circle</span>, <span class="tt">square</span>)</li>
<li>An open-ended type-erased fallback (<span class="tt">any_figure&lt;ayx::val&gt;</span>)</li>
</ul>
</li>
<li>A model map is provided for <span class="tt">std::string</span>, allowing strings to be handled as figures.</li>
<li>So the vector passed to <span class="tt">draw</span> can seamlessly contain both known types (like circle and square) and dynamically extended types (like std::string), all accessed through the same trait-based interface.</li>
</ul>
<p>This example shows how Any++ enables a hybrid approach: you get the performance of <span class="tt">std::variant</span> for known types, while still supporting open-ended extension with type-erased objects. This is useful for scenarios where you want to handle a fixed set of types efficiently, but also allow for runtime extension or plugin types, all through a uniform trait-based interface.</p>
<p>"vany" is a modern, safer, and extensible <strike>variant</strike> version of OLEVariant and QVariant.</p>
<p>[Compiler Explorer] <b>TODO</b></p>
<p>If you are still here, you are ready for <a href="https://www.alexweb.io/anyxx/examples.html">more Examples</a>   </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.16.1 </li>
  </ul>
</div>
</body>
</html>
